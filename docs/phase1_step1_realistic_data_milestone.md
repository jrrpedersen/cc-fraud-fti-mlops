# Phase 1 (v1) — Realistic Synthetic Data: Reference World + Transaction Stream + Integrity Checks

This project follows an **FTI (Feature → Train → Inference)** architecture.  
Phase 1 focuses on the **Feature** side: generating and landing data in an S3-style lake (MinIO) in a way that is realistic and production-aligned.

This document captures the **v1 data generation approach**: a stable “reference world” (dimension tables) plus an incremental transaction stream (events), with a validation step that enforces referential integrity.

---

## Why v1 exists (vs. earlier “v0” generator)

A toy random generator is useful for wiring infrastructure, but not for building meaningful features/models.

The v1 generator improves realism by introducing:

- **Reference entities** (banks, merchants, accounts, cards) that change slowly
- Transactions that **reference those entities** via foreign keys
- **Behavior structure** (home country and travel patterns)
- Fraud labels generated by **plausible attack mechanisms**:
  - chain attacks (online bursts with escalating amounts)
  - geo fraud (far-apart card-present pairs close in time)

---

## Data generation is split into two pipelines

### 1) Bootstrap reference world (slow-changing dimensions)

Airflow DAG: `00_bootstrap_reference_world`

Outputs (JSONL), stored under a **world snapshot id**:

```
landing/reference/world_id=<WORLD_ID>/banks.jsonl
landing/reference/world_id=<WORLD_ID>/merchants.jsonl
landing/reference/world_id=<WORLD_ID>/accounts.jsonl
landing/reference/world_id=<WORLD_ID>/cards.jsonl
landing/reference/_CURRENT            # pointer (text) containing <WORLD_ID>
```

**Why**: in a streaming-like architecture, reference data evolves slowly and should not be regenerated for every transaction batch.

---

### 2) Generate transactions + fraud labels (event stream)

Airflow DAG: `01_generate_and_land_transactions_v1`

This DAG reads `landing/reference/_CURRENT` to determine the active `world_id`, downloads the reference JSONL files, and generates:

- `transactions.jsonl` (event log)
- `fraud_labels.jsonl` (label stream)

Outputs are written as immutable run partitions, plus `_LATEST` pointers:

```
landing/transactions/dt=YYYY-MM-DD/run_id=<RUN_ID>/transactions.jsonl
landing/transactions/dt=YYYY-MM-DD/_LATEST

landing/fraud_labels/dt=YYYY-MM-DD/run_id=<RUN_ID>/fraud_labels.jsonl
landing/fraud_labels/dt=YYYY-MM-DD/_LATEST
```

**Why**: this mirrors a real event pipeline where transactions arrive continuously and are appended (not overwritten).

---

## Integrity checks (why they matter)

Before data can feed feature computation, we enforce a minimum bar of correctness:

### Referential integrity
Every transaction must satisfy:

- `transactions.cc_num` exists in `cards.cc_num`
- `transactions.account_id` exists in `accounts.account_id`
- `transactions.merchant_id` exists in `merchants.merchant_id`

And every fraud label must satisfy:

- `fraud_labels.t_id` exists in `transactions.t_id`
- `fraud_labels.cc_num` exists in `cards.cc_num`

### Schema presence
Transactions must contain required fields (for later features):

- `t_id, cc_num, account_id, merchant_id, amount, currency, country, ip_address, card_present, channel, category, lat, lon, ts`

Fraud labels must contain:

- `t_id, cc_num, explanation, ts`

**Why this is portfolio-relevant**: data quality gates are a core ML engineering skill. These checks become natural places to add Great Expectations / Deequ later.

---

## How to run

1) Start the local stack (Docker Compose)
2) Trigger `00_bootstrap_reference_world` once
3) Trigger `01_generate_and_land_transactions_v1` as many times as you want

After each transaction run, the integrity task should pass and the `_LATEST` pointers should update for that date.

---

## Natural checkpoint for documentation

At this point, we have:

- A reproducible local platform (Airflow + MinIO + Redis)
- A realistic synthetic data world (reference entities)
- A transaction stream generator with fraud mechanisms
- Versioned landing layout with `_CURRENT` + `_LATEST` pointers
- Referential integrity checks